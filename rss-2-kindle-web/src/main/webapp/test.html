<!DOCTYPE html>
<html lang="en">
<head>
    <title>RSS-2-KINDLE Profile</title>
    <meta name="viewport" content="width = device-width, initial-scale = 1.0">

    <!-- JQuery -->
    <script src="js/jquery-3.1.1.js"></script>

    <!-- Bootstrap -->
    <link href="bootstrap/css/bootstrap.min.css" rel="stylesheet">
    <link href="bootstrap/css/bootstrap-theme.min.css" rel="stylesheet">
    <!-- Include all compiled plugins (below), or include individual files as needed -->
    <script src="bootstrap/js/bootstrap.min.js"></script>
    <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
    <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
    <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
    <![endif]-->

    <!-- Custom css -->
    <link href="css/sticky-footer.css" rel="stylesheet">
    <link href="css/profile-theme.css" rel="stylesheet">

</head>

<body>
<script>
    var rootURL = 'http://localhost:8080/rss2kindle/rest/profile/euro';
    var userData;

    $(document).ready(function () {
        //add new subscriber on submit
        $('#new_subscriber_form').submit(function (e) {
            e.preventDefault();
            var email = $('#new_subscriber_email').val();
            var name = $('#new_subscriber_name').val();
            var status = $('#new_subscriber_status').val();
            var updateJson = '{' +
                'email: "' + email + '",' +
                'name: "' + name + '",' +
                'status: "active",' +
                'rsslist: [ ';
            $('#new_subscriber_rsslist option').each(function () {
                updateJson += '{ rss: "' + $(this).val() + '", status: "active"},';
            });
            updateJson = updateJson.substr(0, updateJson.length - 1) + ']}';

            $.ajax({
                url: rootURL + username + '/new',
                contentType: 'application/json',
                type: 'PUT',
                data: updateJson,
                dataType: 'json',
                headers: csrf_headers
            })
                .done(function () {
                    showAlert('success', 'New subscriber <strong>' + name + '</strong> has been added successfully');
                    return true;
                })
                .fail(function () {
                    showAlert('error', 'New subscriber <strong>' + name + '</strong> creation fail');
                    return false;
                })
                .always(function (){
                    reloadSubscribersTable();
                });
        });

        $('#btn_new_subscriber_addrss').click(function (event) {
            var rss = $('#new_subscriber_addrss').val();
            $('#new_subscriber_addrss').popover('destroy');
            if (validateURL(rss))
                $('#new_subscriber_rsslist').append('<option value = "' + rss + '">' + rss + '</option>');
            else {
                $('#new_subscriber_addrss').popover(
                    {
                        content: rss + ' does not look like a valid URL. Please correct it and try again',
                        trigger: 'manual',
                        placement: 'top auto',
                        delay: {"show": 5000, "hide": 20000}
                    });
                $('#new_subscriber_addrss').popover('show');
                //                alert(rss + " does not look like a valid URL. Please correct it and try again");
            }
        });

        $('#btn_new_subscriber_deleterss').click(function (event) {
            $('#new_subscriber_rsslist option:selected').remove();
        });
    });

    function getUserData() {
        return userData;
    }

    function validateURL(url) {
        var regexp = /https?:\/\/(www\.)?[-a-zA-Z0-9@:%._\+~#=]{2,256}\.[a-z]{2,6}\b([-a-zA-Z0-9@:%_\+.~#?&//=]*)/g;
        return url.match(regexp);
    }

</script>

<div class="container-fluid">
    <header class="header clearfix">
        <nav>
            <form id="logout" action="logout" method="post">
                <ul class="nav nav-pills pull-right">
                    <li role="presentation" class="dropdown active">
                        <a class="dropdown-toggle" data-toggle="dropdown" href="#" role="button" aria-haspopup="true"
                           aria-expanded="false">
                            <%=username%> <span class="caret"></span>
                        </a>
                        <ul class="dropdown-menu">
                            <li role="presentation">
                                <a href="javascript:{}"
                                   onclick="document.getElementById('logout').submit(); return false;">Log out</a>
                            </li>
                        </ul>
                    </li>
                    <li role="separator" class="divider"></li>
                    <li role="presentation"><a href="../index.html">Home</a></li>
                    <li role="presentation"><a href="../about.html">About</a></li>
                    <li role="presentation"><a href="../contact.html">Contact</a></li>
                </ul>
            </form>
        </nav>
        <h3 class="text-muted">RSS-2-KINDLE</h3>
    </header>

    <div class="row">
        <nav class="col-sm-3 col-md-2 d-none d-sm-block bg-light sidebar">
            <ul class="nav nav-pills nav-stacked">
                <li role="presentation" class="active"><a href="#">My Profile</a></li>
                <li role="presentation"><a href="subscribers">Subscriber Management</a></li>
                <li role="presentation"><a href="service">Services</a></li>
            </ul>
        </nav>
        <main role="main" class="col-sm-9 col-sm-offset-3 col-md-10 col-md-offset-2 main">
            <h1 class="page-header"><%=username%> dashboard</h1>
            <section class="row text-center placeholders">
                <div class="col-md-4 col-sm-4 placeholder" style="background-color: #c7ddef; border-radius: 70%">
                    <div id="dashboard_user_data">
                        <h4>Status: active</h4>
					</div>
                    <h3>User info</h3>
                    <div class="text-muted" id="dashboard_user_info" >
						Created: 2018-20-27 18:25:67 <br>
						Modified: 2018-20-27 18:25:67 <br>
						Last logged in: 2018-20-27 18:25:67
					</div>
                </div>
                <div class="col-md-4 col-sm-4 placeholder" style="background-color: #f0ad4e; border-radius: 70%">
                    <div id="dashboard_subscribers_data">
                        <h4>Number of subscribers: 2</h4>
                    </div>
                    <h3>Subscribers</h3>
                    <div class="text-muted">
                        Something else <br>
                        something else again <br>
                        again
                    </div>
                </div>
                <div class="col-md-4 col-sm-4 placeholder" style="background-color: #c9e2b3 ">
                    <div id="dashboard_subscriptions_data">
                        <h4>Number of subscriptions: 7</h4>
                    </div>
                    <h3>Subscriptions</h3>
                    <div class="text-muted">
                        Something else <br>
                        something else again <br>
                        again
                    </div>
                </div>
            </section>
            <section class="row placeholders">
                <div class="col-lg-6 placeholder text-left" id="profile_view">
                    <h2 class="sub-header">Subscribers</h2>
                    <table class="table table-hover">
                        <thead>
                        <tr>
                            <th>#</th>
                            <th>Subscriber</th>
                            <th>email</th>
                            <th>status</th>
                        </tr>
                        </thead>
                        <tbody>
                        <tr class="active">
                            <td>1</td>
                            <td>My Kindle</td>
                            <td>dshjs@jdks.ru</td>
                            <td>active</td>
                        </tr>
                        <tr class="danger">
                            <td>2</td>
                            <td>My Kindle</td>
                            <td>dshjs@jdks.ru</td>
                            <td>active</td>
                        </tr>
                        </tbody>
                    </table>
                </div>
                <div class="col-lg-6 placeholder text-left">
                    <h2 class="sub-header">Subsriptions</h2>
                    <table class="table table-hover">
                        <thead>
                        <tr>
                            <th>#</th>
                            <th>Subscription</th>
                            <th>status</th>
                        </tr>
                        </thead>
                        <tbody>
                        <tr>
                            <td>1</td>
                            <td>http://jdkfjdk.ru</td>
                            <td>active</td>
                        </tr>
                        <tr>
                            <td>2</td>
                            <td>http://kjhdkfhk.rui</td>
                            <td>active</td>
                        </tr>
                        <tr>
                            <td>3</td>
                            <td>http://kjhdkfhk.rui</td>
                            <td>failed</td>
                        </tr>
                        </tbody>
                    </table>
                </div>
            </section>
    <section>
        <form method="get" id="new_subscriber_form" action="#">
            <div class="form-group">
                <label for="new_subscriber_email">Email</label>
                <input type="email" id="new_subscriber_email" required class="form-control"/>
            </div>
            <div class="form-group">
                <label for="new_subscriber_name">Name</label>
                <input type="text" id="new_subscriber_name" required class="form-control"/>
            </div>
            <div class="form-group">
                <label for="new_subscriber_rsslist">Subscriptions</label>
                <select class="form-control" id="new_subscriber_rsslist" size="5"></select>
                <div class="form-group">
                    <label for="new_subscriber_addrss" class="control-label">Add new subscription
                        (RSS):</label>
                    <input type="url" class="form-control" id="new_subscriber_addrss"/>
                    <div class="btn-group-xs" role="group">
                        <button type="button" class="btn btn-primary" id="btn_new_subscriber_addrss">+
                        </button>
                        <button type="button" class="btn btn-primary" id="btn_new_subscriber_deleterss">
                            -
                        </button>
                    </div>
                </div>
            </div>
            <div class="form-group">
                <input type="submit" value="Create" class="btn btn-primary"/>
            </div>
        </form>
    </section>
        </main>
    </div>

</div>
</body>
</html>